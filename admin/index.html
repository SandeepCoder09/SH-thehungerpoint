<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard â€” SH The Hunger Point</title>

  <!-- Clean Modern Admin UI -->
  <link rel="stylesheet" href="./admin.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
  <script src="../home/firebase-config.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="menu-toggle" id="menuToggle">â˜°</div>
  
<!-- JWT AUTH CHECK -->
<script>
(async () => {
  const token = localStorage.getItem("admin_jwt");
  if (!token) return location.href = "login.html";

  try {
    const res = await fetch("https://sh-thehungerpoint.onrender.com/admin/verify", {
      headers: { Authorization: "Bearer " + token }
    });

    const data = await res.json();
    if (!data.ok) {
      localStorage.removeItem("admin_jwt");
      location.href = "login.html";
    }
  } catch (err) {
    console.error(err);
    localStorage.removeItem("admin_jwt");
    location.href = "login.html";
  }
})();
</script>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">SH Admin</div>
  <nav>
    <a class="active">Dashboard</a>
    <a>Orders</a>
    <a>Sales</a>
    <a>Notifications</a>
    <a id="logoutBtn">Logout</a>
  </nav>
</aside>

<!-- MAIN CONTENT -->
<section class="main-content">

  <!-- HEADER -->
  <header class="topbar">
    <h1>Dashboard</h1>
  </header>

  <!-- STATS GRID -->
  <section class="stats-grid">
    <div class="stat-card">
      <h3>Total Orders</h3>
      <p id="totalOrders">0</p>
    </div>
    <div class="stat-card">
      <h3>Total Sales</h3>
      <p id="totalSales">â‚¹0</p>
    </div>
    <div class="stat-card">
      <h3>Last 1 Hour</h3>
      <p id="recentOrders">0</p>
    </div>
  </section>

  <!-- CHARTS -->
  <section class="chart-section">
    <div class="chart-box">
      <h3>Orders â€” 24 Hours</h3>
      <canvas id="hourChart"></canvas>
    </div>

    <div class="chart-box">
      <h3>Sales â€” 7 Days</h3>
      <canvas id="weekChart"></canvas>
    </div>
  </section>

  <!-- ORDERS LIST -->
  <section class="orders-container">
    <div class="orders-header">
      <h2>Live Orders</h2>
      <div class="order-controls">
        <input id="searchInput" placeholder="Search ordersâ€¦" />
        <select id="statusFilter">
          <option value="">All</option>
          <option value="paid">Paid</option>
          <option value="preparing">Preparing</option>
          <option value="on the way">On the way</option>
          <option value="completed">Completed</option>
        </select>
      </div>
    </div>

    <div id="ordersList" class="orders-list">Loading ordersâ€¦</div>
  </section>
</section>

  <div id="liveOrderPopup" class="live-order-popup hidden">
  <div class="popup-content">
    <h3>ðŸ”¥ New Order Received</h3>
    <p id="popupOrderId"></p>
    <p id="popupOrderItems"></p>
    <button id="popupClose">OK</button>
  </div>
</div>
  
<!-- SOUND -->
<audio id="newOrderSound">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg" />
</audio>

<!-- DASHBOARD LOGIC -->
<script src="./dashboard.js" defer></script>
<script src="./menu.js"></script>
</body>
</html>
